
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ãƒ¯ã‚¤ãƒ‰äºˆæƒ³ã‚¢ãƒ—ãƒª</title>
</head>
<body>
  <h2>ğŸ“ˆ ãƒ¯ã‚¤ãƒ‰äºˆæƒ³ï¼ˆCSVèª­ã¿è¾¼ã¿ï¼‰</h2>

  <input type="file" id="csvFile" accept=".csv" />
  <button onclick="processCSV()">äºˆæƒ³ã™ã‚‹</button>

  <div id="output"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <script>
    let horses = [];

    function processCSV() {
      const file = document.getElementById('csvFile').files[0];
      if (!file) {
        alert("CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");
        return;
      }

      Papa.parse(file, {
        header: true,
        skipEmptyLines: true,
        complete: function(results) {
          horses = results.data.map(row => ({
            name: row['é¦¬å'],
            popularity: parseInt(row['äººæ°—']),
            odds: parseFloat(row['å˜å‹ã‚ªãƒƒã‚º']),
            jockeyScore: 1.0  // é¨æ‰‹ã‚¹ã‚³ã‚¢ä»®
          }));

          showPrediction();
        }
      });
    }

    function calcScore(horse) {
      return (1 / horse.popularity) * 0.5 + horse.jockeyScore * 0.5;
    }

    function showPrediction() {
      let pairs = [];

      for (let i = 0; i < horses.length; i++) {
        for (let j = i + 1; j < horses.length; j++) {
          const h1 = horses[i];
          const h2 = horses[j];

          const score1 = calcScore(h1);
          const score2 = calcScore(h2);
          const pairScore = score1 + score2;
          const avgOdds = (h1.odds + h2.odds) / 2;
          const expect = pairScore / avgOdds;

          pairs.push({
            pair: `${h1.name} Ã— ${h2.name}`,
            expect: expect.toFixed(2)
          });
        }
      }

      pairs.sort((a, b) => b.expect - a.expect);
      const top3 = pairs.slice(0, 3);

      const output = document.getElementById('output');
      output.innerHTML = '<h3>ğŸ”® ãŠã™ã™ã‚ãƒ¯ã‚¤ãƒ‰çµ„</h3>';
      top3.forEach(p => {
        output.innerHTML += `<p>${p.pair}ï¼ˆæœŸå¾…å€¤: ${p.expect}ï¼‰</p>`;
      });
    }
  </script>
</body>
</html>
